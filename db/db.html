<!DOCTYPE html><html><head><meta charset='utf-8'></head><body><script>
const css = `<style>i {opacity: 0.3; font-style: inherit}
[title]:hover { 
    position: relative
}
.datatable :not(a):not(li):hover { 
    cursor: default; border-bottom: 1px dotted
}
[title]::after {
  content: attr(title);
  display: none;
  background-color: #cccd;
  color: #000;
  font-style: italic;
  text-align: center;
  border-radius: 5px;
  padding: 2px 10px;
  position: absolute;
  z-index: 1;
  right: 0px;
  top: -30px;
}

.datatable span span, .datatable span b { color: #060 }
[title]:hover:after {
  display: block;
}
table { margin: 0 }
a > b { font-weight: normal }
.datatable a {font-weight: bold}
.datatable a:hover { text-decoration: none; color: #2a7ae2 }
.datatable a:hover b { text-decoration: underline; color: #2a7ae2 }
td, th { padding-top: 0.5ch !important; padding-bottom: 0.5ch !important; white-space: nowrap }

@media only screen and (max-width: 680px) {
    .post-content { font-size: 75% }
    td, th { padding: 0.5ch 1.5ch !important }
}

tr th:first-child { text-align: right !important }
th { font-weight: normal }
table { width: auto }
.dt { width: 100%; overflow-x: auto; margin-top: 4ch }

ul { margin: 0 1px 1px 0; }
li { display: inline-block; padding: 0.5ch 1.5ch !important; border: solid 1px; margin: 0 -1px -1px 0;
    border: 1px solid #e8e8e8;
}
li:nth-child(odd) {
    background-color: #f7f7f7;
}
</style>`

    fetch('../empty.html').then(x => x.text()).then(x => {
        document.write(x)
        fetch('../db/db.md').then(x => x.text()).then(db => {
            document.querySelector('.post-title').innerHTML = 'database'
            const hotlinks = []
            db = db.substring(2).split('\n# ')
            datatables = Object.fromEntries(
                db.map(d => d.split('\n').filter(x => x.trim())).map(
                    ([ part, h, , ...b ]) => [
                        part, [h, ...b].map(
                            r => r.slice(1, -1).trim().split('|').map(x => {
                                x = x.trim()
                                if (x[0] === '!') hotlinks.push(x.substring(1))
                                return x.trim()
                            })
                        )
                    ]
                )
                // .map(({ part, thead, tbody }) => [
                //     part, tbody.map(r => Object.fromEntries(
                //         r.map((v, i) => [thead[i], v])
                //     ))
                // ])
            )

            const domElem = document.querySelector('.post-content')

            const printDatatableContent = content => content[0].length > 1
                ? '<table class="datatable">\n' +
                    content.map((row, r) => `  <tr><th>${r || ''}</th>` + row.map((x, i) => {
                        x = x.trim()
                        if (!r) return `<th>${x}</th>`
                        const y = content[0][i]
                        if (x[0] === '!') x = `<span title="${y}" id="_${hotlinks.indexOf(x.substring(1))}"><span><b>${hotlinks.indexOf(x.substring(1))}⟩ </b>${x.substring(1)}</span></span>`
                        else if (hotlinks.includes(x)) x = `<a title="${y}" href="#_${hotlinks.indexOf(x)}"><b>${x}</b> » ${hotlinks.indexOf(x)}</a>`
                        else if (!x) x = `<i>${y}</i>`
                        else x = `<span title="${y}">${x}</span>`
                        return `<td>${x}</td>`
                    }).join('') + '').join('</tr>\n')
                    + '</table>\n'
                : '<ul class="datatable">' + content.slice(1).map(([x]) => {
                    if (x[0] === '!') x = `<span id="_${hotlinks.indexOf(x.substring(1))}"><span><b>${hotlinks.indexOf(x.substring(1))}⟩ </b>${x.substring(1)}</span></span>`
                    else if (hotlinks.includes(x)) x = `<a href="#_${hotlinks.indexOf(x)}"><b>${x}</b> » ${hotlinks.indexOf(x)}</a>`
                    else x = `<span>${x}</span>`
                    return `<li>${x}</li>`
                }).join('') + '</ul>'
            
            domElem.innerHTML = css + '<b id="datatables">datatables = [</b>' +
                Object.keys(datatables).map(dtname => ` <b><a href="#${dtname}">'${dtname}'</a></b>`).join(',')
                + ' <b>]</b>' +
                Object.entries(datatables).map(([ dtname, datatable ]) =>
                    `<div class="dt"><b id="${dtname}"><a href="#datatables">datatables</a>[ '${dtname}' ] =</b>\n`
                    + printDatatableContent(datatable)
            ).join('</div>')
        })
    })
</script></body></html>